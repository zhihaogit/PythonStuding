## 第十章:认识与学习 BASH

### 10.1 认识 BASH这个 Shell

#### 10.1.1 硬件、核心与Shell

用户 --->  使用者界面(Shell, KDE, application)  --->  核心(kernel)  --->  硬件(Hardware)

#### 10.1.2 为何要学命令行的shell

- 各家 distributions使用的 bash都一样
- 远端管理：命令行的传输速度比较快

#### 10.1.3 系统的合法shell与/etc/shells功能

- Shell版本
  - Bourne Shell(sh)
  - Sun的 C Shell
  - 商业上的 K Shell
  - TCSH
  - Bourne Again Shell(bash)
- /etc/shells 可以看到可用的 shells 

#### 10.1.4 Bash shell的功能

- 命令编修能力(history)
  - 默认记录 1000个
  - 在 .bash_history中存储
  - 这一次的命令行会暂存在内存中
- 命令与文件补全功能( [tab]按键的好处)
  - 命令补全
  - 文件补齐
- 命令别名设置功能(alias)
  - `alias lm='ls -a'`
- 工作控制、前景背景控制(job control, foreground, background)
- 程序化脚本(shell scripts)
- 万用字符(Wildcard)

#### 10.1.5 查询指令是否为Bash shell的内置命名: type

- 查看某个指令是来自于外部指令(指非 bash所提供的命令)，还是内置 bash的指令
- `type [-tpa] name`
- 也可以作为类似 which指令的用途，找指令用的

#### 10.1.6 指令的下达与快速编辑按钮

- `\[Enter]` 换行输入

- | 组合键            | 功能与示范                                 |
  | ----------------- | ------------------------------------------ |
  | [ctrl]+u/[ctrl]+k | 分别是从光标处 向前删除或 向后删除指令串   |
  | [ctrl]+a/[ctrl]+e | 分别是让光标移动到指令串的 最前面或 最后面 |

### 10.2 Shell的变量功能

变量对于 bash非常重要

#### 10.2.1 什么是变量

- 让一个特定字符串代表不固定的内容
- 变量的可变性与方便性
- 影响 bash环境操作的变量
- 脚本程序设计(shell script) 的好帮手

#### 10.2.2 变量的取用与设置:echo,变量设置规则,unset

- 变量的取用
  - `echo $variable`
  - `echo $PATH`
  - `echo ${PATH}`
- 设置
  - `myname=abc`
  - `echo ${myname}`
- 变量的设置规则
  - 变量与变量内容以一个等号"="来链接
  - 等号两边不能直接接空白字符
  - 变量名称只能是英文字母与数字，但是开头字符不能是数字
  - 变量内容若有空白字符可使用双引号或 单引号将变量内容结合起来
    - 双引号中可识别变量
    - 单引号中仅为一般字符串
  - 可用跳脱字符`\`将特殊字符变成一般字符（转义字符）
  - 在一串指令中的执行中，还需要由其他额外的指令所提供的信息，可以使用 反单引号或 $(指令)
  - 若该变量为扩增变量内容时，可用 `$变量名称` 或 `${变量}`累加内容
  - 若该变量需要在其他子程序执行，则需要以 export来使变量变成环境变量
  - 通常大写字符为系统默认变量，自行设置变量可使用小写字符
  - 取消变量的方法是使用 unset: `unset 变量名称`

#### 10.2.3 环境变量的功能

- 用 `env`观察环境变量与常见环境变量说明
  - `env`
  - 列出所有的环境变量
  - 包括 export导出的变量
- 用 `set`观察所有变量(含环境变量与 自订变量)
- `PS1` 观察字符的设置
- `$` 关于本shell的PID
- `?` 关于上个执行命令的回传值
- OSTYPE,HOSTTYPE,MACHTYPE 主机硬件与核心的等级
- `export` 自订变量转成环境变量

#### 10.2.4 影响显示结果的语系变量(locale)

- 查询 linux支持的语系
  - `locale -a`
- 整体系统的默认语系定义在 locale.conf

#### 10.2.5 变量的有效范围

- 环境变量=全域变量
- 自订变量=区域变量

#### 10.2.6 变量键盘的读取、阵列与宣告: read,array,declare

- `read`
  - 读取来自键盘输入的变量
  - `read [-pt] variable`
- `declare/typeset`
  - 宣告变量的类型
  - `declare -x sum` 将 sum变成环境变量
  - `declare -r sum` 将 sum变成只读属性
  - `declare +x sum` 将 sum取消环境变量
  - `declare -p sum` 单独列出变量的类型
- bash对变量的定义
  - 变量类型默认为 字符串
  - bash环境中的数值运算，默认最多仅能达到整数形态，1/3 = 0
- 阵列(array) 变量类型
  - `var[index]=content` 设置阵列的每一个 item
  - `echo "${var[1]},${var[2]},${var[3]}"`

#### 10.2.7 与文件系统及程序的限制关系: ulimit

- `ulimit [-SHacdfltu] [配额]`
- 限制使用者的某些系统资源
- `ulimit -a` 列出目前身份的所有限制数据数值
- `ulimit -f 10240` 限制使用者仅能创建 10M以下容量的文件

#### 10.2.8 变量内容的删除、取代与替换

- `path=${PATH}`

- `echo ${path}`

- `echo ${path#/*local/bin:}`  删除 path变量中的 local/bin

- `#` 代表从前面开始删除，仅删除最短的那个，`*` 来取代 0到无穷多个字符

- `##` 代表删除最长的那个

- `:` 代表截止位置

- `%` 代表从后面向前删除变量内容

- | 变量设置方式                                  | 说明                                                         |
  | --------------------------------------------- | ------------------------------------------------------------ |
  | ${变量#关键字} \${变量##关键字}               | 若变量内容从头开始的数据符合“关键字”，则将符合的最短数据删除，若变量内容从头开始的数据符合“关键字”，则将符合的最长数据删除 |
  | ${变量%关键字} \${变量%%关键字}               | 若变量内容从尾向前的数据符合“关键字”，则将符合的最短数据删除，若变量内容从未向前的数据符合“关键字”，则将符合的最长数据删除 |
  | ${变量/旧字串/新字串} \${变量//旧字串/新字串} | 若变量内容符合“旧字串”则第一个旧字串会被新字串取代，若变量内容符合“旧字串”则全部的旧字串会被新字串取代 |

- 变量的测试与内容替换

  - `echo ${username} `  -->  ''

  - `username=${username-root}`

  - `echo ${username}`  -->  root

  - `username="test"`

  - `username=${username-root}`   -->  test
